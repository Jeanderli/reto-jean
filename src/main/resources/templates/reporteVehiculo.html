<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <head th:replace="layout/plantilla::head">
        <title>Conductores</title>
        <meta charset="UTF-8">
    </head>

    <body>
        <header th:replace="layout/plantilla::header"></header>

        <section class="py-4">
            <div class="container">
                <div class="row">
                    <div class="col-md-9">
                        <h1 class="mb-3">[[#{reporteVehiculo.reporteVehiculo}]]</h1>
                    </div>
                    <div class="d-flex justify-content-end align-items-center">
                        <button onclick="descargarPDF()" class="btn btn-outline-secondary me-2">
                            <i class="fas fa-file-pdf"></i> [[#{accion.descargarPDF}]]
                        </button>
                        <a sec:authorize="hasRole('ROLE_ADMIN')" th:href="@{/nuevoReporteVehiculo}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> [[#{accion.nuevo}]]
                        </a>
                    </div>
                </div>

                <div th:if="${reporteVehiculos != null and !reporteVehiculos.empty}">
                    <div class="table-responsive">
                        <table id="reporteVehiculo" class="table table-striped table-hover table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>[[#{reporteVehiculo.conductor}]]</th>
                                    <th>[[#{reporteVehiculo.placa}]]</th>
                                    <th>[[#{reporteVehiculo.horaInicial}]]</th>
                                    <th>[[#{reporteVehiculo.kmInicial}]]</th>                   
                                    <th>[[#{reporteVehiculo.numCombustibleI}]]</th>
                                    <th>[[#{reporteVehiculo.reconocimientoI}]]</th>
                                    <th>[[#{reporteVehiculo.horaFinal}]]</th>
                                    <th>[[#{reporteVehiculo.numCombustibleF}]]</th>
                                    <th>[[#{reporteVehiculo.reconocimientoF}]]</th>
                                    <th>[[#{reporteVehiculo.totalKm_Dia}]]</th>
                                    <th>[[#{reporteVehiculo.observaciones}]]</th>
                                    <th>[[#{reporteVehiculo.recoconocimiento_Vehiculo}]]</th>
                                    <th sec:authorize="hasRole('ROLE_ADMIN')" class="text-center"></th> 
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="reporteVehiculo : ${reporteVehiculos}">
                                    <td th:text="${reporteVehiculo.conductor.nombre}">Mostrar conductor</td>
                                    <td th:text="${reporteVehiculo.placa}">Mostrar placa</td>
                                    <td th:text="${reporteVehiculo.horaInicial}">Mostrar horaInicial</td>
                                    <td th:text="${reporteVehiculo.kmInicial}">Mostrar kmInicial</td>
                                    <td th:text="${reporteVehiculo.numCombustibleI}">Mostrar numCombustibleI</td>
                                    <td th:text="${reporteVehiculo.reconocimientoI}">Mostrar reconocimientoI</td>
                                    <td th:text="${reporteVehiculo.horaFinal}">Mostrar horaFinal</td>
                                    <td th:text="${reporteVehiculo.numCombustibleF}">Mostrar numCombustibleF</td>
                                    <td th:text="${reporteVehiculo.reconocimientoF}">Mostrar reconocimientoF</td>
                                    <td th:text="${reporteVehiculo.totalKm_Dia}">Mostrar totalKm_Dia</td>
                                    <td th:text="${reporteVehiculo.observaciones}">Mostrar observaciones</td>
                                    <td th:text="${reporteVehiculo.recoconocimiento_Vehiculo}">Mostrar recoconocimiento_Vehiculo</td>
                                    <td sec:authorize="hasRole('ROLE_ADMIN')" class="text-center">
                                        <div class="d-flex justify-content-center gap-2">
                                            <a th:href="@{/editarReporteVehiculo/{idReporteVehiculo}(idReporteVehiculo=${reporteVehiculo.idReporteVehiculo})}"
                                               class="btn btn-secondary btn-sm">
                                                <i class="fas fa-edit"></i> [[#{accion.editar}]]
                                            </a>
                                            <a th:href="@{/eliminarReporteVehiculo/{idReporteVehiculo}(idReporteVehiculo=${reporteVehiculo.idReporteVehiculo})}"
                                               class="btn btn-danger btn-sm">
                                                <i class="fas fa-trash"></i> [[#{accion.eliminar}]]
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div th:if="${reporteVehiculos == null or reporteVehiculos.empty}" class="alert alert-info" role="alert">
                    [[#{reporteVehiculo.lista-vacia}]]
                </div>
            </div>
        </section>

        <footer th:replace="layout/plantilla::footer"></footer>
        <script>
            async function descargarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text("Reporte de Tabla", 14, 15);

            doc.autoTable({
            html: '#reporteVehiculo',  // toma directamente la tabla HTML
            startY: 20,
            styles: {
            fontSize: 5,
            cellPadding: 3
            },
            headStyles: {
            fillColor: [22, 160, 133] // color turquesa
            }
            });

            doc.save("tabla.pdf");
            }
        </script>

    </body>

</html>